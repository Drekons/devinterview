<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Базы данных</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/default.min.css">
</head>
<body>
<div class="container">
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">DevInterview</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="php.html">PHP - вопросы</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php_tasks.html">PHP - задачи</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="go.html">Go - вопросы</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="go_tasks.html">Go - задачи</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="db.html">Базы данных</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="architecture.html">Архитектура</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="accordion" id="accordionBlock">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q1">
                        Нормализация
                    </button>
                </h2>
                <div id="q1" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        <b>Первая НФ</b> - Все поля являются скалярными, не должно быть повторений<br/>
                        <b>Вторая НФ</b> - Все ключевые значения должны завесить от первичного ключа,
                        т.е. набор ключевых значений должен быть уникальным<br/>
                        <b>Третья НФ</b> - Все ключевые и не ключевые значения должны завесить от первичного ключа<br/>
                        <b>НФ Бойса-Кодда</b> - Ключевые атрибуты составного ключа не должны зависеть от неключевых
                        атрибутов<br/>
                        <b>Четвертая НФ</b> - В таблицах должны отсутствовать нетривиальные многозначные
                        зависимости<br/>
                        <b>Четвертая НФ</b> - В таблицах должны отсутствовать нетривиальные многозначные
                        зависимости<br/>
                        <b>Пятая НФ</b> - В таблице каждая нетривиальная зависимость соединения должна определяться
                        потенциальным ключом этой таблицы.<br/>
                        <b>Доменно-ключевая НФ</b> - Каждое наложенное ограничение на таблицу должно являться логическим
                        следствием ограничений доменов и ограничений ключей, которые накладываются на данную
                        таблицу.<br/>
                        <b>Шестая НФ</b> - Таблица находится в 6NF, когда она неприводима, то есть не может быть
                        подвергнута дальнейшей декомпозиции без потерь.<br/>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q2">
                        Денормализация
                    </button>
                </h2>
                <div id="q2" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Это отхождение от правил нормализации бд, для повышения скорости доступа к данным. Например, в
                        highload проектах.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q3">
                        Первичный ключ
                    </button>
                </h2>
                <div id="q3" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Кластерный индекс, вид индекса хранящегося вместе с данными, поэтому возможен только один
                        PK.<br/>
                        Обязательно уникальный, используется для ссылок.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q4">
                        Транзакции (+уровни изоляции)
                    </button>
                </h2>
                <div id="q4" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        <b>Транзакция</b> — это набор операций по работе с базой данных (БД), объединенных в одну
                        атомарную
                        пачку.<br/>
                        Команды для работы с транзакциями в MySQL:
                        <code>BEGIN</code>, <code>COMMIT</code>, <code>ROLLBACK</code>.<br/>
                        <br/>
                        <b>Уровни изоляции транзакций:</b><br/>
                        - <b>Read uncommitted</b> - плохая согласованность, но большая скорость выполнения.
                        Каждая транзакция видит незафиксированные изменения другой транзакции (грязное чтение).<br/>
                        - <b>Read committed</b> - видны только зафиксированные действия (неповторяющееся чтение (чтение
                        UPDATE и DELETE) и чтение
                        фантомов (чтение INSERT))<br/>
                        - <b>Repeatable read</b> - Уровень, позволяющий предотвратить феномен неповторяющегося чтения.
                        Т.е. мы не видим в исполняющейся транзакции измененные и удаленные записи другой транзакцией. Но
                        все еще видим вставленные записи из другой транзакции.<br/>
                        - <b>Serializable</b> - Уровень, при котором транзакции ведут себя как будто ничего более не
                        существует, никакого влияния друг на друга нет. В классическом представлении этот уровень
                        избавляет от эффекта чтения фантомов.<br/>
                        Самый медленный режим работы<br/>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q5">
                        ACID
                    </button>
                </h2>
                <div id="q5" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        <b>Atomicity — Атомарность</b> - Атомарность гарантирует, что каждая транзакция будет выполнена
                        полностью или не будет выполнена совсем. Не допускаются промежуточные состояния.<br/>
                        <b>Consistency — Согласованность</b> - Благодаря тому, что транзакция не допускает промежуточных
                        результатов, база остается консистентной. То есть до выполнения операции и после база остается
                        консистентной<br/>
                        <b>Isolation — Изолированность</b> - Во время выполнения транзакции параллельные транзакции не
                        должны оказывать влияния на её результат.<br/>
                        <b>Durability — Надёжность</b> - Если пользователь получил подтверждение от системы, что
                        транзакция выполнена, он может быть уверен, что сделанные им изменения не будут отменены из-за
                        какого-либо сбоя.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q6">
                        Индексы
                    </button>
                </h2>
                <div id="q6" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Объект базы данных, создаваемый с целью повышения производительности поиска данных.
                        <br/>
                        <b>B-tree</b> - сбалансированное дерево, каждый элемент представляет собой скалярное значение
                        которое
                        ссылается на первичный ключ. Каждое плечо в дереве может иметь несколько потомков.<br/>
                        Сложность выборки log(N)
                        <br/>
                        <b>Hash индекс</b> - строит хэш таблицу на основание хэш функции, поваляет осуществлять быстрые
                        выборки. Чаще всего применяется для индексирования строчных или двоичных данных.<br/>
                        Сложность выборки линейная
                        <br/>
                        <b>Пространственные индексы</b> - Пространственный индекс представляет собой тип расширенного
                        индекса, позволяющий индексировать пространственные столбцы. Пространственный столбец
                        представляет собой столбец таблицы, в котором содержатся данные пространственного типа, например
                        geometry или geography.
                        <br/>
                        <b>Bitmap</b> - В bitmap-структурах создается двухмерный массив со столбцом для каждой строки в
                        индексируемой таблице. Каждый столбец представляет отдельное значение в bitmap-индексе. Этот
                        двухмерный массив показывает каждое значение индекса, умноженное на количество строк в этой
                        таблице.<br/>
                        Особое преимущество bitmap-индексирования проявляется, когда одна таблица включает несколько
                        bitmap-индексов. Мощность каждого столбца может быть невысокой. Создание нескольких
                        bitmap-индексов предоставляет очень сильный подход для быстрого ответа на сложные SQL-запросы.
                        <br/>
                        <b>Составной индекс</b> - Составным называют индекс, который: может включать более одного (до
                        16) столбцов, выступающих ключевыми значениями.
                        <br/>
                        <b>Покрывающие индексы</b> - Покрывающими индексами называются некластеризованные индексы,
                        которые разрешают один или несколько схожих результатов запроса напрямую, без доступа к базовой
                        таблице и без уточняющих запросов.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q7">
                        Репликация
                    </button>
                </h2>
                <div id="q7" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Механизм синхронизации содержимого нескольких копий объекта.<br/>
                        Master-master - репликация когда возможно писать сразу в несколько таблиц<br/>
                        Master-slave - репликация когда возможно читать сразу из несколько таблиц<br/>
                        Используется в основном slave репликация.<br/>
                        Назначение: повышение скорости или бэкап бд.<br/>
                        Slave хранят текущую позицию в мастер бд, после чего ходят в мастер и считывают из лога запросов
                        отставшие от slave данные из мастера.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q8">
                        Партиционирование
                    </button>
                </h2>
                <div id="q8" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Партиционирование - это разбиение больших таблиц на логические части по выбранным
                        критериям.<br/>
                        В MySQL ключевое слово <code>PARTITION</code>, указывает условия по какому принципу будет
                        происходить партиционирование. Физически происходит разбивка на разные файлы по типа партиций и
                        запись данных по правилам в них.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q9">
                        Шардирование
                    </button>
                </h2>
                <div id="q9" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Шардирование - это разделение данных из одной бд в разные.<br/>
                        Существует два принципа шардирования:<br/>
                        <ol>
                            <li>Шардирование по гео - т.е. мы разносим данные по серверам в зависимости от их
                                геолокации
                            </li>
                            <li>Шардирование по типам данных - т.е. мы разносим данные по их связанности, например одна
                                бд для товаров, другая для заказов
                            </li>
                        </ol>
                        Шардирование реализуется некоторыми энтерпрайз решениями (например у Percona) или же на уровне
                        кода.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#q10">
                        Поиск медленных запросов (EXPLAIN)
                    </button>
                </h2>
                <div id="q10" class="accordion-collapse collapse" data-bs-parent="#accordionBlock">
                    <div class="accordion-body">
                        Для поиска медленных запросов нужно пройти следующий процесс:
                        <ol>
                            <li>Проверить код на наличие ошибок (например запросы в цикле)</li>
                            <li>Вычислить запрос который выполняется медленно</li>
                            <li>Првоерить запрос при помощи EXPLAIN</li>
                            <li>Если возможно добавить необходимы индексы</li>
                            <li>Если это не поможет применить репликацию или шардирование</li>
                        </ol>
                        EXPLAIN позволяет увидеть какие индексы использовались в запросе и как много строк было
                        затронуто при выполнении запроса. Цель добавления индекса снижение кол-ва затронутых строк.
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/languages/go.min.js"></script>
<script>hljs.highlightAll();</script>
</html>